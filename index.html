<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MU_Modem: MU_Modem</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MU_Modem
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">MU_Modem </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> サーキットデザイン社製MUシリーズ無線モデムを制御するためのArduinoライブラリです。</p>
<p><b>本ライブラリは、動作保証、並びに個別のサポートは行っておりません。 自己責任の上、各ソフトウェアライセンスを尊重のうえご利用ください。<br  />
ご質問やバグのご報告はGitHubのIssueをご利用ください。</b></p>
<h1><a class="anchor" id="autotoc_md1"></a>
概要</h1>
<p>このライブラリは、Arduinoでサーキットデザイン社製MUシリーズ無線モデム（例：MU-3-429及びMU-3-1216、MU-4-429）を制御するためのインターフェースを提供します。 シリアルコマンドインターフェースを介して、データの送受信やモデムの設定を簡単に行うことができます。</p>
<p>API等は以下ドキュメントをご参照ください。<br  />
 <a href="https://circuitdesign-inc.github.io/MU_Modem/">https://circuitdesign-inc.github.io/MU_Modem/</a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
対応ハードウェア</h1>
<ul>
<li>Circuit Design MU-3-429</li>
<li>Circuit Design MU-3-1216</li>
<li>Circuit Design MU-4-429</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
インストール</h1>
<ol type="1">
<li>GitHubリポジトリから最新のリリースをダウンロードします。</li>
<li>Arduino IDEで、<code>スケッチ</code> &gt; <code>ライブラリをインクルード</code> &gt; <code>.ZIP形式のライブラリをインストール...</code> に移動します。</li>
<li>ダウンロードしたZIPファイルを選択します。</li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
基本的な使い方</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
ハードウェアのセットアップ</h2>
<p>MUモデムをArduinoなどのマイクロコントローラと接続するための基本的なセットアップ方法です。 詳細は各モデムのデータシートを必ずご確認ください。</p>
<h3><a class="anchor" id="autotoc_md6"></a>
必須の接続</h3>
<p>最低限、以下の4つの端子を接続する必要があります。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">MU端子   </th><th class="markdownTableHeadCenter">接続先 (Arduino)   </th><th class="markdownTableHeadLeft">説明    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>VCC</code>   </td><td class="markdownTableBodyCenter">3.0V ~ 5.0V   </td><td class="markdownTableBodyLeft">安定化された電源を接続します。Arduinoの<code>5V</code>または<code>3.3V</code>ピンに接続します。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>GND</code>   </td><td class="markdownTableBodyCenter"><code>GND</code>   </td><td class="markdownTableBodyLeft">グランドを接続します。    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>TXD</code>   </td><td class="markdownTableBodyCenter">Arduinoの <code>RX</code>   </td><td class="markdownTableBodyLeft">MUモデムの送信(TXD)をArduinoの受信(RX)に接続します。コントロール電圧はVCCに依存します。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>RXD</code>   </td><td class="markdownTableBodyCenter">Arduinoの <code>TX</code>   </td><td class="markdownTableBodyLeft">MUモデムの受信(RXD)をArduinoの送信(TX)に接続します。コントロール電圧はVCCに依存します。   </td></tr>
</table>
<p><b>【重要】</b></p><ul>
<li><b>モード設定</b>: <code>MODE</code> (10番ピン) は**コマンドモード**に設定する必要があります。<code>VCC</code>と同じ電圧（Highレベル）に接続してください。</li>
<li><b>ロジックレベル</b>: MUモデムのロジックレベルは電源電圧(VCC)に依存します。ArduinoとMUモデムの電源電圧を合わせてください（例: どちらも5V、またはどちらも3.3V）。電圧が異なる場合は、ロジックレベル変換ICが必要です。</li>
<li><b>未使用端子</b>: 使用しない端子はデータシートの指示に従い、オープン（未接続）にしてください。</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
オプションの接続</h3>
<p>必要に応じて、以下の端子も接続できます。</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">MU端子   </th><th class="markdownTableHeadCenter">接続先 (Arduino)   </th><th class="markdownTableHeadLeft">説明    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>RTS</code>   </td><td class="markdownTableBodyCenter">Arduinoのデジタル入力ピン   </td><td class="markdownTableBodyLeft">ハードウェアフロー制御用の出力です。モデムがデータ受信可能かを示します。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>CTS</code>   </td><td class="markdownTableBodyCenter">Arduinoのデジタル出力ピン   </td><td class="markdownTableBodyLeft">ハードウェアフロー制御用の入力です。モデムにデータ送信を許可/禁止します。    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>TX-LED</code>   </td><td class="markdownTableBodyCenter">LED   </td><td class="markdownTableBodyLeft">データ送信中に点灯するLEDを接続できます。電流制限抵抗が必要です。    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>RX-LED</code>   </td><td class="markdownTableBodyCenter">LED   </td><td class="markdownTableBodyLeft">データ受信中に点灯するLEDを接続できます。電流制限抵抗が必要です。   </td></tr>
</table>
<p><b>注意</b>: 本ライブラリはハードウェアフロー制御(<code>RTS</code>/<code>CTS</code>)を標準では使用しません。使用する場合は、ご自身で制御ロジックを実装する必要があります。</p>
<h2><a class="anchor" id="autotoc_md8"></a>
プログラム</h2>
<p>以下は、MUモデムを初期化し、データを受信し、5秒ごとにメッセージを送信する基本的なサンプルコードです。 詳細なサンプルはexsamplesフォルダをご確認ください。</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;MU_Modem.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// MUモデムのインスタンスを作成</span></div>
<div class="line">MU_Modem modem;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// データ受信時に呼び出されるコールバック関数</span></div>
<div class="line"><span class="keywordtype">void</span> modemCallback(MU_Modem_Error error, MU_Modem_Response responseType, int32_t value, <span class="keyword">const</span> uint8_t *pPayload, uint16_t len, <span class="keyword">const</span> uint8_t* pRouteInfo, uint8_t numRouteNodes)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (responseType == MU_Modem_Response::DataReceived &amp;&amp; error == MU_Modem_Error::Ok)</div>
<div class="line">  {</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;\n--- データ受信 ---&quot;</span>);</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;RSSI: %d dBm, 長さ: %u バイト\n&quot;</span>, (int16_t)value, len);</div>
<div class="line">    Serial.print(<span class="stringliteral">&quot;ペイロード: &quot;</span>);</div>
<div class="line">    Serial.write(pPayload, len);</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;\n--------------------&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// PCとの通信用シリアルを開始</span></div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  <span class="keywordflow">while</span> (!Serial);</div>
<div class="line">  Serial.println(<span class="stringliteral">&quot;MU Modem Basic Example&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// MUモデムとの通信用シリアル(Serial1など)を開始</span></div>
<div class="line">  <span class="comment">// デフォルトのボーレートは19200bps</span></div>
<div class="line">  Serial1.begin(MU_DEFAULT_BAUDRATE);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// モデムを初期化</span></div>
<div class="line">  <span class="comment">// 第1引数: 通信に使うStreamオブジェクト</span></div>
<div class="line">  <span class="comment">// 第2引数: 使用するモデムの周波数モデル(MHz_429:MU-3-429とMU-4-429, MHz_1216:MU-3-1216に対応)</span></div>
<div class="line">  <span class="comment">// 第3引数: データ受信時に呼び出すコールバック関数 (受信しない場合はnullptr)</span></div>
<div class="line">  MU_Modem_Error err = modem.begin(Serial1, MU_Modem_FrequencyModel::MHz_429, modemCallback);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (err != MU_Modem_Error::Ok) {</div>
<div class="line">    Serial.println(<span class="stringliteral">&quot;MUモデムの初期化に失敗しました。&quot;</span>);</div>
<div class="line">    <span class="keywordflow">while</span> (1);</div>
<div class="line">  }</div>
<div class="line">  Serial.println(<span class="stringliteral">&quot;MUモデムの初期化が完了しました。&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// モデムの各種設定 (任意)</span></div>
<div class="line">  modem.SetChannel(0x07, <span class="keyword">false</span>);      <span class="comment">// チャンネルを7に設定</span></div>
<div class="line">  modem.SetEquipmentID(0x01, <span class="keyword">false</span>);  <span class="comment">// 自局IDを1に設定</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// この関数をループ内で常に呼び出す必要があります。</span></div>
<div class="line">  <span class="comment">// 受信データの解析やコールバックの呼び出しを行います。</span></div>
<div class="line">  modem.Work();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// 5秒ごとにメッセージを送信する例</span></div>
<div class="line">  <span class="keyword">static</span> uint32_t lastSendTime = 0;</div>
<div class="line">  <span class="keywordflow">if</span> (millis() - lastSendTime &gt; 5000) {</div>
<div class="line">    lastSendTime = millis();</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* message = <span class="stringliteral">&quot;Hello, MU-Modem!&quot;</span>;</div>
<div class="line">    Serial.printf(<span class="stringliteral">&quot;&#39;%s&#39; を送信します...\n&quot;</span>, message);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// データ送信 (目的局IDは事前にSetDestinationID()で設定)</span></div>
<div class="line">    MU_Modem_Error tx_err = modem.TransmitData((<span class="keyword">const</span> uint8_t*)message, strlen(message));</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (tx_err == MU_Modem_Error::Ok) {</div>
<div class="line">      Serial.println(<span class="stringliteral">&quot;送信に成功しました。&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      Serial.printf(<span class="stringliteral">&quot;送信に失敗しました。エラー: %d\n&quot;</span>, (<span class="keywordtype">int</span>)tx_err);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md9"></a>
デバッグ</h1>
<p>platformioを使用している場合、ライブラリのデバッグ出力を有効にすることができます。</p>
<p>デバッグ機能を有効にするには、platformio.iniに以下のビルドフラグ追加してください: </p><div class="fragment"><div class="line">build_flags = -D ENABLE_MU_MODEM_DEBUG</div>
</div><!-- fragment --><p>また、デバッグの出力先を以下の関数で指定する必要があります。 </p><div class="fragment"><div class="line"><span class="comment">// デバッグの出力先を設定</span></div>
<div class="line">modem.setDebugStream(&amp;Serial);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md10"></a>
License</h1>
<p>このライブラリはMITライセンスの下でリリースされています。 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
